<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quotes</title>
<style>
body { font-family: Arial; margin: 2rem; background: #f2f2f2; }
h2 { margin-bottom: 1rem; }
table { border-collapse: collapse; width: 100%; margin-bottom: 2rem; background: #fff; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background: #333; color: #fff; }
form { background: #fff; padding: 1rem; border-radius: 8px; margin-bottom: 2rem; }
input, textarea, select { width: 100%; padding: 0.5rem; margin-top: 0.5rem; }
button { margin-top: 1rem; padding: 0.5rem 1rem; }
</style>
</head>
<body>
<h2>Quotes</h2>

<form id="quoteForm">
<h3>Create Quote</h3>
<label>Sale ID<input type="number" name="sale_id" required></label>
<label>Customer Name<input type="text" name="customer_name" required></label>
<label>Kitchen Model<input type="text" name="kitchen_model" required></label>
<label>Quote Total<input type="number" name="quote_total" required></label>
<label>Notes<textarea name="notes"></textarea></label>
<button type="submit">Create Quote</button>
</form>

<h3>Existing Quotes</h3>
<table id="quotesTable">
  <thead>
    <tr>
      <th>ID</th>
      <th>Sale ID</th>
      <th>Customer</th>
      <th>Kitchen</th>
      <th>Total</th>
      <th>Notes</th>
      <th>Created By</th>
      <th>Created At</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const token = localStorage.getItem('token');
if (!token) window.location.href = '/login.html';

async function fetchQuotes() {
  const res = await fetch('/api/quotes', { headers: { 'Authorization': 'Bearer ' + token } });
  const data = await res.json();
  if (!data.success) { alert(data.message); return; }

  const tbody = document.querySelector('#quotesTable tbody');
  tbody.innerHTML = '';
  data.quotes.forEach(q => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${q.id}</td>
                    <td>${q.sale_id}</td>
                    <td>${q.customer_name}</td>
                    <td>${q.kitchen_model}</td>
                    <td>${q.quote_total}</td>
                    <td>${q.notes}</td>
                    <td>${q.created_by}</td>
                    <td>${q.created_at}</td>`;
    tbody.appendChild(tr);
  });
}

document.getElementById('quoteForm').addEventListener('submit', async e => {
  e.preventDefault();
  const form = e.target;
  const body = {
    sale_id: form.sale_id.value,
    customer_name: form.customer_name.value,
    kitchen_model: form.kitchen_model.value,
    quote_total: form.quote_total.value,
    notes: form.notes.value
  };
  const res = await fetch('/api/quotes', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
    body: JSON.stringify(body)
  });
  const data = await res.json();
  if (data.success) {
    alert('Quote created successfully');
    form.reset();
    fetchQuotes();
  } else alert(data.message);
});

fetchQuotes();
</script>
</body>
</html>
